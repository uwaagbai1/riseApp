{% extends 'account/base_generic.html' %}
{% load static %}

{% block content %}
<div class="hp-main-layout-content">
    <div class="row mb-32 gy-32">
        <div class="col-12">
            <div class="hp-bg-black-bg py-32 py-sm-64 px-24 px-sm-48 px-md-80 position-relative overflow-hidden hp-page-content" style="border-radius: 32px;">
                <svg width="358" height="336" fill="none" xmlns="http://www.w3.org/2000/svg" class="position-absolute hp-rtl-scale-x-n1" style="bottom: 0px; right: 0px;">
                    <path d="M730.404 135.471 369.675-6.641l88.802 164.001-243.179-98.8 246.364 263.281-329.128-126.619 114.698 166.726-241.68-62.446" stroke="url(#a)" stroke-width="40" stroke-linejoin="bevel"></path>
                    <defs>
                        <linearGradient id="a" x1="315.467" y1="6.875" x2="397.957" y2="337.724" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#fff"></stop>
                            <stop offset="1" stop-color="#fff" stop-opacity="0"></stop>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="row">
                    <div class="col-sm-8 col-12">
                        <div class="row">
                            <div class="col-12">
                                <h1 class="mb-0 hp-text-color-black-0">Your Assigned Subjects</h1>
                                <h4 class="mt-8 hp-text-color-black-0">Subjects for {{ selected_session.name|default:'N/A' }} Term {{ selected_term|default:'N/A' }}</h4>
                                <p class="mt-2 hp-text-color-black-0">Class: {{ student.current_class.level|default:'N/A' }}{% if student.current_section %} {{ student.current_section.suffix }}{% endif %}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="row g-32">
                <div class="col-12">
                    <div class="card hp-bg-color-dark-90 p-24">
                        <div class="d-flex justify-content-between align-items-center mb-16 flex-wrap">
                            <h3>Assigned Subjects</h3>
                        </div>

                        <form method="GET" class="mb-24" id="filter-form">
                            <div class="row g-16 align-items-end">
                                <div class="col-md-4 col-sm-6">
                                    <label for="session" class="form-label">Session</label>
                                    <select name="session" id="session" class="form-select">
                                        {% for session in sessions %}
                                            <option value="{{ session.id }}" {% if session.id == selected_session.id %}selected{% endif %}>{{ session.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-4 col-sm-6">
                                    <label for="term" class="form-label">Term</label>
                                    <select name="term" id="term" class="form-select">
                                        {% for term in terms %}
                                            <option value="{{ term.0 }}" {% if term.0 == selected_term %}selected{% endif %}>{{ term.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </form>

                        {% if assigned_subjects %}
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table">
                                        <tr>
                                            <th style="border: 1px solid #444;">Subject</th>
                                            <th style="border: 1px solid #444;">Assigned By</th>
                                            <th style="border: 1px solid #444;">Assigned On</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for subject in assigned_subjects %}
                                            <tr>
                                                <td style="border: 1px solid #444;">{{ subject.subject.name }}</td>
                                                <td style="border: 1px solid #444;">{{ subject.assigned_by.full_name|default:"N/A" }}</td>
                                                <td style="border: 1px solid #444;">{{ subject.assigned_at|date:"F d, Y" }}</td>
                                            </tr>
                                        {% empty %}
                                            <tr>
                                                <td colspan="3" class="text-center" style="border: 1px solid #444;">
                                                    <div class="alert alert-info mb-0">
                                                        <i class="bi bi-info-circle-fill me-2"></i>No subjects assigned for this session and term.
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-dark hp-p1-body">
                                <i class="bi bi-info-circle-fill me-2"></i>No subjects assigned for {{ selected_session.name|default:'N/A' }} Term {{ selected_term|default:'N/A' }}.
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .form-label {
        font-weight: bold;
        margin-bottom: 0.5rem;
    }
    .form-select {
        border-radius: 8px;
    }
    .table th, .table td {
        padding: 12px;
        vertical-align: middle;
    }
    .table-hover tbody tr:hover {
        background-color: #2a2e34;
    }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function() {
        // Initialize tooltips
        $('[data-toggle="tooltip"]').tooltip();

        // Show toast messages if any
        $('.toast').each(function() {
            var toast = new bootstrap.Toast(this);
            toast.show();
        });

        // Automatically submit form when session or term changes
        $('#session, #term').on('change', function() {
            $('#filter-form').submit();
        });
    });
</script>
{% endblock content %}