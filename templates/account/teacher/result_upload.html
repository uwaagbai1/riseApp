{% extends 'account/base_generic.html' %}
{% load static %}
{% block content %}
<div class="hp-main-layout-content">
    <div class="row mb-32 gy-32">
        <div class="col-12">
            <div class="hp-bg-black-bg py-32 py-sm-64 px-24 px-sm-48 px-md-80 position-relative overflow-hidden hp-page-content" style="border-radius: 32px;">
                <svg width="358" height="336" fill="none" xmlns="http://www.w3.org/2000/svg" class="position-absolute hp-rtl-scale-x-n1" style="bottom: 0px; right: 0px;">
                    <path d="M730.404 135.471 369.675-6.641l88.802 164.001-243.179-98.8 246.364 263.281-329.128-126.619 114.698 166.726-241.68-62.446" stroke="url(#a)" stroke-width="40" stroke-linejoin="bevel"></path>
                    <defs>
                        <linearGradient id="a" x1="315.467" y1="6.875" x2="397.957" y2="337.724" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#fff"></stop>
                            <stop offset="1" stop-color="#fff" stop-opacity="0"></stop>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="row">
                    <div class="col-sm-6 col-12">
                        <h1 class="mb-0 hp-text-color-black-0">Upload Results</h1>
                        <h4 class="mt-8 hp-text-color-black-0">Select a student to manage results</h4>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-12">
            <div class="row g-32">
                <div class="col-12">
                    <div class="card hp-bg-color-dark-90 p-24">
                        <h3>Result Upload Form</h3>
                        <p class="hp-p1-body">Select a student, session, and term to enter results.</p>

                        {% if messages %}
                        <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1055;">
                            {% for message in messages %}
                            <div class="toast align-items-center text-white {% if message.tags == 'error' %}bg-danger{% else %}bg-success{% endif %} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                                <div class="d-flex">
                                    <div class="toast-body">
                                        {{ message }}
                                    </div>
                                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <form method="POST" action="{% url 'teacher_result_upload' %}">
                            {% csrf_token %}
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="student" class="form-label hp-p1-body">Student</label>
                                    <select class="form-control" id="student" name="student" required>
                                        <option value="">Select a student</option>
                                        {% for student in students %}
                                        <option value="{{ student.admission_number }}">{{ student.full_name }} ({{ student.current_section }})</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="session" class="form-label hp-p1-body">Session</label>
                                    <select class="form-control" id="session" name="session" required>
                                        {% for session in sessions %}
                                        <option value="{{ session.id }}" {% if session.id == current_session.id %}selected{% endif %}>{{ session.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="term" class="form-label hp-p1-body">Term</label>
                                    <select class="form-control" id="term" name="term" required>
                                        {% for term in terms %}
                                        <option value="{{ term.0 }}" {% if term.0 == current_term %}selected{% endif %}>{{ term.1 }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-dark mt-16">Select Student</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function() {
            $('.toast').each(function() {
                var toast = new bootstrap.Toast(this, {
                    autohide: true,
                    delay: 5000
                });
                toast.show();
            });

            if ($('.toast').length > 3) {
                $('.toast').slice(0, $('.toast').length - 3).each(function() {
                    bootstrap.Toast.getInstance(this).hide();
                });
            }
        });
    </script>
{% endblock %}